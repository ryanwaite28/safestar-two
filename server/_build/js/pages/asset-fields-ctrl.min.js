"use strict";$(document).ready(function(){var t,s,e=location.pathname.split("/"),n=e[e.length-1],i=$("#new_asset_field_name"),a=$("#new_asset_field_value"),o=$("#asset_fields_count"),l=$("#asset_fields_list"),_=$("#asset_name_heading"),d={};client.check_session().then(function(e){return t=e,client.get_user_asset(n)}).then(function(e){return s=e.user_asset,_.text(s.name),Promise.all([client.get_asset_fields_count(s.id),client.get_asset_fields(s.id)])}).then(function(e){if(console.log(t,s,e),tools.array_sort_by(e[1].asset_fields,"id","desc").forEach(function(e){d[e.unique_value]=e,l.append($(e.dom))}),o.text(e[0].count),0===e[0].count)return $("a#load-more-btn").remove()}).catch(function(e){console.log("error",e)}),$(document).on("click","a#submit_new_asset_field_btn",function(){var e=i.val(),t=a.val();tools.setActionButtonsDisabledState(!0),client.add_asset_field({asset_field_name:e,asset_field_value:t,asset_id:s.id}).then(function(e){console.log(e),tools.setActionButtonsDisabledState(!1),window.M.toast({html:e.message}),e.error||(d[e.new_asset_field.unique_value]=e.new_asset_field,l.prepend($(e.new_asset_field.dom)),i.val(""),a.val(""),o.text(Object.keys(d).length))})}),$(document).on("click","a.edit_asset_field_btn",function(e){var t=$(this).data("asset_field_unique_value");$("#edit_asset_field_box_"+t).toggleClass("ghost-1")}),$(document).on("click","a.delete_asset_field_btn",function(e){var s=$(this).data("asset_field_unique_value"),t=d[s];t&&window.confirm('Are you sure you want to delete "'+t.name+'"?')&&(tools.setActionButtonsDisabledState(!0),client.delete_asset_field({asset_field_id:t.id}).then(function(e){if(console.log(e),tools.setActionButtonsDisabledState(!1),window.M.toast({html:e.message}),!e.error){var t=$("#asset_field_"+s);$(t).remove(),delete d[s],o.text(Object.keys(d).length)}}))}),$(document).on("click","a.submit_edits_asset_field_btn",function(e){var n=$(this).data("asset_field_unique_value"),t=d[n];if(t){var s="#edit_asset_field_value_input_"+n,i=$("#edit_asset_field_name_input_"+n).val(),a=$(s).val();tools.setActionButtonsDisabledState(!0),client.edit_asset_field({asset_field_name:i,asset_field_value:a,asset_field_id:t.id}).then(function(e){if(console.log(e),tools.setActionButtonsDisabledState(!1),window.M.toast({html:e.message}),!e.error){var t=$("#asset_field_"+n),s=$(e.asset_field.dom);t.replaceWith(s),d[n]=e.asset_field,o.text(Object.keys(d).length)}})}}),$(document).on("click","a#load-more-btn",function(){var e=Object.keys(d).map(function(e){return d[e].id}).reduce(function(e,t){return Math.min(e,t)});client.get_asset_fields(s.id,e).then(function(e){if(0===e.asset_fields.length)return $("a#load-more-btn").remove();tools.array_sort_by(e.asset_fields,"id","desc").forEach(function(e){d[e.unique_value]=e,l.append($(e.dom))})})})});