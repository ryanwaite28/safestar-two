"use strict";$(document).ready(function(){var n=$("#new_user_field_name"),i=$("#new_user_field_value"),o=$("#user_fields_count"),s=$("#user_fields_list"),l=$("#first_name_span"),u=$("#middle_name_span"),_=$("#last_name_span"),a={},e=[client.check_session(),client.get_user_fields(),client.get_user_fields_count()];Promise.all(e).then(function(e){var t=e[0];if(l.text(tools.capitalize(t.user.fname)),u.text(tools.capitalize(t.user.mname)),_.text(tools.capitalize(t.user.lname)),tools.array_sort_by(e[1].user_fields,"id","desc").forEach(function(e){a[e.unique_value]=e,s.append($(e.dom))}),o.text(e[2].count),0===e[2].count)return $("a#load-more-btn").remove()}).catch(function(e){console.log("error",e)}),$(document).on("click","a#submit_new_user_field_btn",function(){var e=n.val(),t=i.val();tools.setActionButtonsDisabledState(!0),client.add_user_field({user_field_name:e,user_field_value:t}).then(function(e){console.log(e),tools.setActionButtonsDisabledState(!1),window.M.toast({html:e.message}),e.error||(a[e.new_user_field.unique_value]=e.new_user_field,s.prepend($(e.new_user_field.dom)),n.val(""),i.val(""),o.text(Object.keys(a).length))})}),$(document).on("click","a.edit_user_field_btn",function(e){var t=$(this).data("user_field_unique_value");$("#edit_user_field_box_"+t).toggleClass("ghost-1")}),$(document).on("click","a.delete_user_field_btn",function(e){var n=$(this).data("user_field_unique_value"),t=a[n];t&&window.confirm('Are you sure you want to delete "'+t.name+'"?')&&(tools.setActionButtonsDisabledState(!0),client.delete_user_field({user_field_id:t.id}).then(function(e){if(console.log(e),tools.setActionButtonsDisabledState(!1),window.M.toast({html:e.message}),!e.error){var t=$("#user_field_"+n);$(t).remove(),delete a[n],o.text(Object.keys(a).length)}}))}),$(document).on("click","a.submit_edits_user_field_btn",function(e){var i=$(this).data("user_field_unique_value"),t=a[i];if(t){var n="#edit_user_field_value_input_"+i,s=$("#edit_user_field_name_input_"+i).val(),l=$(n).val();tools.setActionButtonsDisabledState(!0),client.edit_user_field({user_field_name:s,user_field_value:l,user_field_id:t.id}).then(function(e){if(console.log(e),tools.setActionButtonsDisabledState(!1),window.M.toast({html:e.message}),!e.error){var t=$("#user_field_"+i),n=$(e.user_field.dom);t.replaceWith(n),a[i]=e.user_field,o.text(Object.keys(a).length)}})}}),$(document).on("click","a#load-more-btn",function(){var e=Object.keys(a).map(function(e){return a[e].id}).reduce(function(e,t){return Math.min(e,t)});client.get_user_fields(e).then(function(e){if(0===e.user_fields.length)return $("a#load-more-btn").remove();tools.array_sort_by(e.user_fields,"id","desc").forEach(function(e){a[e.unique_value]=e,s.append($(e.dom))})})})});